name: iOS build artifact (disabled)

on:
  workflow_dispatch:

jobs:
  build-ios:
    runs-on: macos-15
    timeout-minutes: 60

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: "8.0.x"

      - name: Install iOS workload
        run: dotnet workload install ios

      - name: Use Xcode 16.4
        run: sudo xcode-select -switch /Applications/Xcode_16.4.app

      - name: Publish device IPA
        run: dotnet publish osu.iOS/osu.iOS.csproj -c Debug -f net8.0-ios -r ios-arm64 -p:BuildIpa=true -p:MtouchLink=SdkOnly

      - name: Locate outputs
        shell: bash
        run: |
          echo "Searching for .ipa..."
          find . -maxdepth 8 -type f -name "*.ipa" -print || true
          echo "Searching for .app..."
          find . -maxdepth 8 -type d -name "*.app" -print || true

      - name: Zip first .app (if present)
        shell: bash
        run: |
          APP_DIR="$(find . -maxdepth 8 -type d -name '*.app' | head -n 1)"
          if [ -z "$APP_DIR" ]; then
            echo "No .app found (maybe produced .ipa instead)."
            exit 0
          fi
          echo "Using APP_DIR=$APP_DIR"
          ditto -c -k --sequesterRsrc --keepParent "$APP_DIR" osu-iOS-app.zip

      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: osu-ios-build
          path: |
            **/*.ipa
            osu-iOS-app.zip